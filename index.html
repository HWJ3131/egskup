<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>ì²« ê¸€ì ë§íˆê¸° ì˜ì–´ í€´ì¦ˆ (í‚¤ì¦ˆ ëª¨ë“œ)</title>
<style>
  :root {
    /* ì—°í•œ í•‘í¬ í…Œë§ˆ */
    --bg: #ffd9e6;            /* ì „ì²´ ë°°ê²½ */
    --card: #fff2f7;          /* ì¹´ë“œ ë°°ê²½ */
    --text: #4a2b35;          /* ë³¸ë¬¸ í…ìŠ¤íŠ¸(ì§™ì€ ìì£¼ìƒ‰) */
    --muted: #7a5561;         /* ë³´ì¡° í…ìŠ¤íŠ¸ */
    --accent: #ff92b2;        /* í¬ì¸íŠ¸ ë²„íŠ¼ */
    --accent-press: #ff7aa1;  /* ë²„íŠ¼ ëˆŒë¦¼ */
    --ok: #1f8a70;
    --bad: #cc3344;
    --radius: 20px;
  }
  * { box-sizing: border-box; }
  html, body { height: 100%; }
  body {
    margin: 0;
    font-family: ui-rounded, system-ui, -apple-system, "Apple SD Gothic Neo", "Noto Sans KR", "ë§‘ì€ ê³ ë”•", sans-serif;
    background: var(--bg);
    color: var(--text);
    padding: 16px;
  }
  .app { max-width: 960px; margin: 0 auto; }
  .card {
    background: var(--card);
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: 0 8px 24px rgba(0,0,0,.08);
  }
  h1 {
    margin: 8px 0 12px; font-weight: 900; letter-spacing: -.4px;
    font-size: clamp(22px, 5vw, 32px);
  }
  .row { display: grid; gap: 12px; grid-template-columns: 1fr; }
  @media (min-width: 720px){ .row.two { grid-template-columns: 1fr 1fr; } }
  label { font-size: 16px; color: var(--muted); }
  input[type="text"], select {
    width: 100%; padding: 14px 16px; border-radius: 14px;
    border: 2px solid #ffc0d1; background: #fff; color: var(--text);
    font-size: 18px;
  }
  button {
    appearance: none; border: 0; background: var(--accent); color: #4a2b35;
    font-weight: 800; padding: 14px 18px; border-radius: 14px; cursor: pointer;
    font-size: 18px; touch-action: manipulation;
  }
  button:active { background: var(--accent-press); transform: translateY(1px); }
  button.secondary { background: #ffe1ec; color: var(--text); border: 2px solid #ffc0d1; }

  /* ì´ë¯¸ì§€ ë” í¼ */
  .quiz-img {
    width: min(80vw, 360px); height: min(80vw, 360px);
    object-fit: cover; border-radius: 20px; border: 3px solid #ffc0d1;
    background: #fff; display: block; margin: 8px auto 12px;
  }

  .word {
    font-size: clamp(28px, 7vw, 40px);
    letter-spacing: 2px; text-align: center; margin: 6px 0 14px;
    font-weight: 900;
  }

  .status {
    display:flex; gap:10px; flex-wrap: wrap; justify-content: center;
    font-size: 16px; color: var(--muted);
  }
  .pill {
    border: 2px solid #ffc0d1; background: #fff; padding: 8px 12px;
    border-radius: 999px; font-weight: 700;
  }

  /* ë³´ê¸° ë²„íŠ¼: í°íŠ¸ 1.5ë°°(ê¸°ì¡´ ëŒ€ë¹„), í„°ì¹˜íŒ¨ë“œ í¬ê²Œ */
  .choices {
    display:grid; gap: 12px; grid-template-columns: 1fr 1fr; margin: 12px 0 4px;
  }
  .choice {
    background:#fff; color: var(--text); border: 3px solid #ffc0d1;
    font-size: clamp(22px, 6.5vw, 28px); /* í¬ê²Œ! */
    padding: 16px 12px; border-radius: 16px;
    min-height: 64px;
  }
  /* ì¦‰ì‹œ ì •ë‹µ ìƒ‰ìƒí‘œì‹œ ì œê±° -> í´ë˜ìŠ¤ ìì²´ ì‚¬ìš© ì•ˆ í•¨ */

  .result { font-size: 18px; line-height: 1.6; }
  .ok { color: var(--ok); font-weight: 800; }
  .bad { color: var(--bad); font-weight: 800; }

  .bar {
    height: 8px; border-radius: 999px; background: #ffd1df; overflow: hidden; margin-top: 8px;
  }
  .bar > span { display:block; height:100%; background: #ff92b2; width:0%; transition: width .2s; }
</style>
</head>
<body>
<div class="app">
  <div class="card">
    <h1>ì²« ê¸€ì ë§íˆê¸° ì˜ì–´ í€´ì¦ˆ</h1>
    <p style="color:var(--muted); margin-top:-6px">
      ì‚¬ì§„ê³¼ ë‹¨ì–´ë¥¼ ë³´ê³ , <b>ì²« ê¸€ì</b>ì— í•´ë‹¹í•˜ëŠ” ë³´ê¸°(4ì§€ì„ ë‹¤)ë¥¼ ëˆŒëŸ¬ìš”!
    </p>

    <!-- ì„¤ì • -->
    <div id="setup">
      <div class="row two">
        <div>
          <label>í”Œë ˆì´ì–´ ì´ë¦„</label>
          <input id="playerName" type="text" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" inputmode="text" />
        </div>
        <div>
          <label>ì¹´í…Œê³ ë¦¬</label>
          <select id="category">
            <option value="fruits">ê³¼ì¼</option>
            <option value="foods">ìŒì‹</option>
            <option value="sports">ìš´ë™</option>
            <option value="objects">ë¬¼ê±´</option>
            <option value="tools">ë„êµ¬</option>
            <option value="plants">ì‹ë¬¼</option>
            <option value="jobs">ì§ì—…</option>
            <option value="animals">ë™ë¬¼</option>
          </select>
        </div>
      </div>
      <div style="margin-top:12px; display:flex; gap:8px; flex-wrap: wrap;">
        <button id="startBtn">í€´ì¦ˆ ì‹œì‘</button>
        <button class="secondary" id="resetBtn">ì´ˆê¸°í™”</button>
      </div>
      <div id="setupError" style="display:none; color:#fff; background:#cc3344; border:2px solid #e07; padding:10px; border-radius:12px; margin-top:8px;"></div>
    </div>

    <!-- í€´ì¦ˆ -->
    <div id="quiz" style="display:none; margin-top:16px;">
      <div class="status" style="margin-bottom:8px;">
        <span class="pill">ë¬¸ì œ <span id="qIndex">1</span> / <span id="qTotal">10</span></span>
        <span class="pill">ì´ë²ˆ ë¬¸ì œ ì‹œê°„: <span id="qTime">0.00</span>s</span>
        <span class="pill">ì´ ì‹œê°„: <span id="totalTime">0.00</span>s</span>
      </div>

      <div class="bar" aria-hidden="true"><span id="progress"></span></div>

      <img id="qImage" class="quiz-img" alt="quiz image" src="">
      <div class="word"><span id="qShown">_pple</span></div>

      <div class="choices">
        <button class="choice" id="ch0" aria-label="ì²« ê¸€ì ì„ íƒ 1"></button>
        <button class="choice" id="ch1" aria-label="ì²« ê¸€ì ì„ íƒ 2"></button>
        <button class="choice" id="ch2" aria-label="ì²« ê¸€ì ì„ íƒ 3"></button>
        <button class="choice" id="ch3" aria-label="ì²« ê¸€ì ì„ íƒ 4"></button>
      </div>

      <div style="display:flex; gap:8px; justify-content:center; margin-top:6px;">
        <button class="secondary" id="skipBtn">ëª¨ë¥´ê² ì–´ìš”</button>
        <!-- Next ë²„íŠ¼ ì œê±°: ìë™ ì§„í–‰ -->
      </div>
    </div>

    <!-- ê²°ê³¼ -->
    <div id="result" style="display:none; margin-top:16px;">
      <h2>ê²°ê³¼</h2>
      <div class="result" id="resultText"></div>
      <div style="margin-top:12px; display:flex; gap:8px; flex-wrap: wrap;">
        <button id="retryBtn">ë‹¤ì‹œ í’€ê¸°</button>
      </div>
    </div>
  </div>
</div>

<script>
/** â–¼ ì—°ê²° ì„¤ì • â–¼
 *  - ê°™ì€ Vercel í”„ë¡œì íŠ¸ì—ì„œ ì •ì  í˜ì´ì§€ë„ ì„œë¹™í•œë‹¤ë©´: const API_BASE = '';
 *  - GitHub Pages ë“± ë‹¤ë¥¸ ê³³ì—ì„œ í˜¸ìŠ¤íŒ…í•˜ë©´: const API_BASE = 'https://<your>.vercel.app';
 */
const API_BASE = '';
const TOTAL_QUESTIONS = 10;

/* DOM */
const $ = (id)=>document.getElementById(id);
const qImage=$('qImage'),qShown=$('qShown'),qIndex=$('qIndex'),qTotal=$('qTotal');
const qTime=$('qTime'),totalTime=$('totalTime'),progress=$('progress');
const choiceBtns=[$('ch0'),$('ch1'),$('ch2'),$('ch3')],skipBtn=$('skipBtn');

let state={playerName:'',category:'fruits',questions:[],idx:0,startAt:0,qStartAt:0,ticker:0,
  perQuestionTimes:[],perQuestionCorrect:[],questionWords:[],questionShown:[],currentChoices:[],currentCorrectLetter:''};

qTotal.textContent = TOTAL_QUESTIONS;

function startTimer(){const tick=()=>{const now=performance.now();
  qTime.textContent=((now-state.qStartAt)/1000).toFixed(2);
  totalTime.textContent=((now-state.startAt)/1000).toFixed(2);
  state.ticker=requestAnimationFrame(tick)};state.ticker=requestAnimationFrame(tick);}
function stopTimer(){if(state.ticker)cancelAnimationFrame(state.ticker);}

function resetAll(){
  stopTimer();
  state={playerName:'',category:'fruits',questions:[],idx:0,startAt:0,qStartAt:0,ticker:0,
    perQuestionTimes:[],perQuestionCorrect:[],questionWords:[],questionShown:[],currentChoices:[],currentCorrectLetter:''};
  $('playerName').value='';$('category').value='fruits';
  setup.style.display='';quiz.style.display='none';result.style.display='none';
  progress.style.width='0%';
}

async function loadQuizSet(category,n=TOTAL_QUESTIONS){
  const url=`${API_BASE}/api/quiz?category=${encodeURIComponent(category)}&n=${n}`;
  const r=await fetch(url);
  if(!r.ok) throw new Error('API_ERROR:'+r.status);
  const d=await r.json();
  if(!d.ok||!d.items) throw new Error(d.error||'API_DATA_ERROR');
  return d.items;
}

function updateProgress(){
  const pct = Math.min(100, Math.round((state.idx)/state.questions.length*100));
  progress.style.width = pct + '%';
}

function showQuestion(){
  updateProgress();
  const q=state.questions[state.idx];
  qImage.src=q.img; qImage.alt=q.word; qShown.textContent=q.shown; qIndex.textContent=(state.idx+1);

  state.questionWords[state.idx]=q.word; state.questionShown[state.idx]=q.shown;
  state.currentChoices=q.choices; state.currentCorrectLetter=q.word[0].toLowerCase();

  choiceBtns.forEach((btn,i)=>{
    btn.textContent=q.choices[i].toUpperCase();
    btn.disabled=false;
    // ëˆ„ë¥´ë©´ ì¦‰ì‹œ ë‹µ ê¸°ë¡ + ë‹¤ìŒ ë¬¸ì œë¡œ ìë™ ì§„í–‰ (ìƒ‰ìƒí‘œì‹œ/í´ë˜ìŠ¤ ì—†ìŒ)
    btn.onclick=()=>submitChoiceAndAdvance(q.choices[i]);
  });

  skipBtn.disabled=false;
  state.qStartAt=performance.now();
}

function submitChoiceAndAdvance(letter){
  // ì‹œê°„/ì •ì˜¤ë§Œ ê¸°ë¡ (ì¦‰ì‹œ ìƒ‰ìƒí‘œì‹œ ì—†ìŒ, ìë™ ì§„í–‰)
  state.perQuestionTimes[state.idx]=Math.round(performance.now()-state.qStartAt);
  state.perQuestionCorrect[state.idx]=(letter===state.currentCorrectLetter);

  // ì´ì¤‘ íƒ­ ë°©ì§€: ì ê¹ ë¹„í™œì„±í™” í›„ ë‹¤ìŒ ë¬¸ì œ
  choiceBtns.forEach(btn=>btn.disabled=true);
  skipBtn.disabled=true;

  // ì•„ì£¼ ì§§ì€ ë”œë ˆì´(ì•„ì´ê°€ ëˆŒë €ë‹¤ëŠ” í”¼ë“œë°± ëŠë‚Œ)
  setTimeout(nextQuestion, 200);
}

function nextQuestion(){
  state.idx++;
  if (state.idx >= state.questions.length) finishQuiz();
  else showQuestion();
}

function finishQuiz(){
  stopTimer();
  progress.style.width='100%';

  const totalMs=Math.round(performance.now()-state.startAt);
  const correctCount=state.perQuestionCorrect.filter(Boolean).length;
  const wrongCount=state.questions.length - correctCount;
  const accuracy=correctCount/state.questions.length;
  const sec=(ms)=>(ms/1000).toFixed(2);

  // âœ… ìµœì¢…ì—ì„œë§Œ ì •ì˜¤í‘œ ì œê³µ + ë°œìŒ ë²„íŠ¼ ì¶”ê°€
  let wordListHtml='<h3 style="margin-top:6px;">ë¬¸ì œë³„ ë‹¨ì–´</h3><ul>';
  state.questionWords.forEach((w,idx)=>{
    if(!w) return;
    const mark=state.perQuestionCorrect[idx]?'âœ…':'âŒ';
    wordListHtml+=`
      <li style="margin:6px 0;">
        ${mark} ${w}
        <button onclick="speakWord('${w}')" style="
          margin-left:6px; font-size:14px; padding:4px 8px;
          border-radius:8px; border:1px solid #ccc;
        ">ğŸ”Š</button>
      </li>`;
  });
  wordListHtml+='</ul>';

  $('resultText').innerHTML=`
    <p><b>${state.playerName}</b>ì˜ ê²°ê³¼</p>
    <ul>
      <li>ì¹´í…Œê³ ë¦¬: <b>${state.category}</b></li>
      <li>ì´ ì†Œìš”ì‹œê°„: <b>${sec(totalMs)}s</b></li>
      <li>ì •ë‹µ/ì˜¤ë‹µ: <b class="ok">${correctCount}</b> / <b class="bad">${wrongCount}</b></li>
      <li>ì •ë‹µë¥ : <b>${(accuracy*100).toFixed(1)}%</b></li>
    </ul>
    ${wordListHtml}
  `;

  // ì €ì¥ ë¡œì§ì€ ê·¸ëŒ€ë¡œ
  const payload={ 
    playerName:state.playerName, category:state.category, totalTimeMs:totalMs,
    perQuestionTimes:state.perQuestionTimes, perQuestionCorrect:state.perQuestionCorrect,
    questionWords:state.questionWords, questionShown:state.questionShown,
    correctCount, wrongCount, accuracy
  };
  fetch(`${API_BASE}/api/save`, {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify(payload)
  }).then(r=>r.json()).then(j=>console.log('save:', j)).catch(e=>console.error('save error', e));

  quiz.style.display='none'; result.style.display='';
}

// âœ… ë°œìŒ ê¸°ëŠ¥ í•¨ìˆ˜ ì¶”ê°€
function speakWord(word){
  if (!('speechSynthesis' in window)) {
    alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ë°œìŒì„ ì§€ì›í•˜ì§€ ì•Šì•„ìš”.');
    return;
  }
  const utter = new SpeechSynthesisUtterance(word);
  utter.lang = 'en-US';   // ì˜ì–´ ë°œìŒ
  utter.rate = 0.9;       // ì¡°ê¸ˆ ì²œì²œíˆ
  speechSynthesis.speak(utter);
}


/* ì‹œì‘ */
async function startQuiz(){
  const name=document.getElementById('playerName').value.trim();
  const cat=document.getElementById('category').value;
  if(!name){ alert('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
  try {
    state.playerName=name; state.category=cat;
    const items=await loadQuizSet(cat,TOTAL_QUESTIONS);
    state.questions=items; state.idx=0; state.startAt=performance.now();
    state.perQuestionTimes=new Array(items.length).fill(0);
    state.perQuestionCorrect=new Array(items.length).fill(false);
    state.questionWords=new Array(items.length).fill('');
    state.questionShown=new Array(items.length).fill('');
    setup.style.display='none'; quiz.style.display=''; result.style.display='none';
    showQuestion(); startTimer();
  } catch(e){
    console.error(e);
    const el=document.getElementById('setupError');
    el.textContent='ë¬¸ì œë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš”. ì¸í„°ë„· ì—°ê²°/API ìƒíƒœë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”.';
    el.style.display='';
  }
}

document.getElementById('startBtn').addEventListener('click', startQuiz);
document.getElementById('resetBtn').addEventListener('click', resetAll);
document.getElementById('retryBtn').addEventListener('click', resetAll);
document.getElementById('skipBtn').addEventListener('click', ()=>{
  // ì˜¤ë‹µ ì²˜ë¦¬ í›„ ìë™ ì§„í–‰
  state.perQuestionTimes[state.idx]=Math.round(performance.now()-state.qStartAt);
  state.perQuestionCorrect[state.idx]=false;
  submitChoiceAndAdvance('__SKIP__');
});
</script>
</body>
</html>


